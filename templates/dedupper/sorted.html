{% load static %}
{% load render_table from django_tables2 %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>Duplify | Rep List</title>
    <style>
        .btn-default{
            background-color: #222529;
        }
        small{
            color: white;
        }
        .pager li{
            display: inline;
        }

        .nav-item{
            z-index: 1000;
        }
        a:hover{
            text-decoration: none;
        }
        table{
            z-index: 1090;
        }

    </style>
</head>
<body class="bg-dark text-white" style="overflow: hidden">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://www.jqueryscript.net/demo/Polygonal-Particles-Background-polygonizr/polygonizr.min.js"></script>
<script>

    $(function () {
        document.getElementById("new-undi").defaultValue- "70";
        document.getElementById("undi-dup").defaultValue- "98";

        $("#new-undi").change(function(){
            $(".bg-primary").width($("#new-undi").val()+'%');
            let n_u = Number($("#new-undi").val());
            let u_d = Number($("#undi-dup").val());
            let mid =  (u_d-n_u);
            let end = 100 - (n_u + mid);
            $(".bg-warning").width(mid+'%');
            $(".bg-primary").width(n_u+'%');
            $(".bg-success").width(end+'%');
        });

        $("#undi-dup").change(function(){
            let n_u = Number($("#new-undi").val());
            let u_d = Number($("#undi-dup").val());
            let thres = u_d-n_u;
            $(".bg-warning").width(thres+'%');
            $(".bg-success").width(100-u_d+'%');
        });
    });

    function resort() {
        let n_u = Number($("#new-undi").val());
        let u_d = Number($("#undi-dup").val());
        $(".modal-body, .modal-footer").hide();
        $(".modal-title").text("Reps are being sorted!");

        $.getJSON("{% url 'resort' %}", {lower_thres: n_u,  upper_thres: u_d}, function (result) {
            location.reload(true);

        }).fail(function () {alert('wtf bro');

        });



    }
    function bg() {

        $("body").polygonizr({

            restNodeMovements: 0,// How long to pause in between new node-movements.

            duration: 4, // When the cluster updates, this sets speed of nodes.

            nodeMovementDistance: 400, // Define the maximum distance to move nodes.

            numberOfNodes: 36,// The number of node nodes to print out.

            nodeDotSize: 2.5,// Define the maximum size of each node dot.

            nodeEase: "linear",//linear, easeIn, easeOut, easeInOut, accelerateDecelerate.

            nodeFancyEntrance: false,// If true, the nodes will descend into place on load.

            randomizePolygonMeshNetworkFormation: false,// Makes the cluster forms an ellipse inspired formation, random if true.

            // Define a formula for how to initialize each node dot's position.
            specifyPolygonMeshNetworkFormation: function (i) {
                var forEachNode = {// Half a circle and randomized
                    x: this.canvasWidth - ((this.canvasWidth / 2) + (this.canvasHeight / 2) * Math.cos(i * (2 * Math.PI / this.numberOfNodes))) * Math.random(),
                    y: this.canvasHeight - (this.canvasHeight * (i / this.numberOfNodes))
                };
                return forEachNode;
            },

            nodeRelations: 15,// Number of relations between nodes.

            animationFps: 300, // The FPS for the whole canvas.

            nodeDotColor: "0, 0 0 ",// Sets the color of the nodes in the network (RGB).

            nodeLineColor: "0, 0, 0 ",// Sets the color of the lines in the network (RGB).

            nodeFillColor: "0, 0, 0 ",// Sets the color of  triangles in the network (RGB).

            nodeFillAlpha: 2,// Sets the alpha level for the colors (1-0).

            nodeLineAlpha: 0, // Sets the alpha level for the lines (1-0).

            nodeDotAlpha: 0,// Sets the alpha level for the dots (1-0).

            nodeFillSpace: true,// Defines if the triangles in the network should be shown.

            nodeGlowing: false,// Define if the active animation should glow or not (not CPU friendly).

            // Define the canvas size and css position.
            canvasWidth: $(this).width(),
            canvasHeight: $(this).height(),
            canvasPosition: "absolute"

        });
        $("body").polygonizr({

            restNodeMovements: 0,// How long to pause in between new node-movements.

            duration: 8, // When the cluster updates, this sets speed of nodes.

            nodeMovementDistance: 400, // Define the maximum distance to move nodes.

            numberOfNodes: 36,// The number of node nodes to print out.

            nodeDotSize: 1,// Define the maximum size of each node dot.

            nodeEase: "linear",//linear, easeIn, easeOut, easeInOut, accelerateDecelerate.

            nodeFancyEntrance: false,// If true, the nodes will descend into place on load.

            randomizePolygonMeshNetworkFormation: false,// Makes the cluster forms an ellipse inspired formation, random if true.

            // Define a formula for how to initialize each node dot's position.
            specifyPolygonMeshNetworkFormation: function (i) {
                var forEachNode = {// Half a circle and randomized
                    x: this.canvasWidth - ((this.canvasWidth / 2) + (this.canvasHeight / 2) * Math.cos(i * (2 * Math.PI / this.numberOfNodes))) * Math.random(),
                    y: this.canvasHeight - (this.canvasHeight * (i / this.numberOfNodes))
                };
                return forEachNode;
            },

            nodeRelations: 15,// Number of relations between nodes.

            animationFps: 300, // The FPS for the whole canvas.

            nodeDotColor: "255, 255, 255 ",// Sets the color of the nodes in the network (RGB).

            nodeLineColor: "255, 255, 255",// Sets the color of the lines in the network (RGB).

            nodeFillColor: "255, 255, 255 ",// Sets the color of  triangles in the network (RGB).

            nodeFillAlpha: 3,// Sets the alpha level for the colors (1-0).

            nodeLineAlpha: 0, // Sets the alpha level for the lines (1-0).

            nodeDotAlpha: 0,// Sets the alpha level for the dots (1-0).

            nodeFillSpace: true,// Defines if the triangles in the network should be shown.

            nodeGlowing: false,// Define if the active animation should glow or not (not CPU friendly).

            // Define the canvas size and css position.
            canvasWidth: $(this).width(),
            canvasHeight: $(this).height(),
            canvasPosition: "absolute"

        });
    }
    bg();

    var colors = new Array(
        [255,255,255],
        [127.5,127.5,127.5],
        [0,0,0],
        [255,255,255],
        [127.5,127.5,127.5],
        [0,0,0]);

    var step = 0;
    var colorIndices = [0,1,2,3];

    //transition speed
    var gradientSpeed = 0.001;

    function updateGradient()
    {

        if ( $===undefined ) return;

        var c0_0 = colors[colorIndices[0]];
        var c0_1 = colors[colorIndices[1]];
        var c1_0 = colors[colorIndices[2]];
        var c1_1 = colors[colorIndices[3]];

        var istep = 1 - step;
        var r1 = Math.round(istep * c0_0[0] + step * c0_1[0]);
        var g1 = Math.round(istep * c0_0[1] + step * c0_1[1]);
        var b1 = Math.round(istep * c0_0[2] + step * c0_1[2]);
        var color1 = "rgb("+r1+","+g1+","+b1+")";

        var r2 = Math.round(istep * c1_0[0] + step * c1_1[0]);
        var g2 = Math.round(istep * c1_0[1] + step * c1_1[1]);
        var b2 = Math.round(istep * c1_0[2] + step * c1_1[2]);
        var color2 = "rgb("+r2+","+g2+","+b2+")";

        $('body').css({
            background: "-webkit-gradient(linear, left top, right top, from("+color1+"), to("+color2+"))"}).css({
            background: "-moz-linear-gradient(left, "+color1+" 0%, "+color2+" 100%)"});

        step += gradientSpeed;
        if ( step >= 1 )
        {
            step %= 1;
            colorIndices[0] = colorIndices[1];
            colorIndices[2] = colorIndices[3];

            //pick two new target color indices
            //do not pick the same as the current one
            colorIndices[1] = ( colorIndices[1] + Math.floor( 1 + Math.random() * (colors.length - 1))) % colors.length;
            colorIndices[3] = ( colorIndices[3] + Math.floor( 1 + Math.random() * (colors.length - 1))) % colors.length;

        }
    }

    setInterval(updateGradient,10);

    function f() {
        if (confirm('WARNING: You are about to erase all records in the database.')) {
            window.location.replace("{% url 'flush_db' %}");
        } else {
            // Do nothing!
        }
    }
</script>

<nav class="navbar navbar-dark bg-dark navbar-expand-lg justify-content-between rounded-bottom">
    <a class="navbar-brand" href="/">Duplify</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item active">
                <a class="nav-link" href="#" data-toggle="modal" data-target="#update-sort" aria-haspopup="true"
                   aria-expanded="false">Update Sorting <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item ">
                <a class="nav-link" href="#" data-toggle="modal" data-target="#exampleModalCenter" aria-haspopup="true" aria-expanded="false">
                    Duplify Reports
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="javascript:f()">Reset</a>
            </li>

        </ul>
    </div>
</nav>
<div class="modal fade text-dark" id="exampleModalCenter" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-center" id="exampleModalLongTitle">Reports</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <a  href="report/A" class=" my-3 btn btn-block badge-pill btn-large btn-success" >Audit Report </a>
                <a  href="report/D" class=" my-3 btn btn-block badge-pill btn-large btn-success" >Duplify Report </a>
                <a href="report/DD" class="my-3 btn btn-block badge-pill btn-large btn-success" >Dedup Report</a>
                <a href="report/U" class="my-3 btn btn-block badge-pill btn-large btn-success" >Upload Report</a>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade text-dark" id="update-sort" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title text-center" id="exampleModalLongTitle">Sorting</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h4>Adjust the Duplify Sorter</h4>
                <p>This will sort all reps based on the new thresholds.</p>
                <div class="col-12">
                    <div class="progress">
                        <div class="progress-bar bg-primary" style="width: 70%">
                            <span class="sr-only">35% Complete (success)</span>
                        </div>
                        <div class="progress-bar bg-warning" style="width: 28%">
                            <span class="sr-only">20% Complete (warning)</span>
                        </div>
                        <div class="progress-bar bg-success" style="width: 2%">
                            <span class="sr-only">15% Complete (primary)</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="input-group my-3 col-6">
                        <div class="input-group-prepend col-">
                            <span class="input-group-text col-12" id="basic-addon1">New-Undecided</span>
                        </div>
                        <input type="number" class="form-control col-3" value=70 id="new-undi">
                    </div>
                    <div class="input-group my-3 col-6">
                        <div class="input-group-prepend col-">
                            <span class="input-group-text col-12" id="basic-addon1">Undecided-Dup</span>
                        </div>
                        <input type="number" class="form-control col-3" value=98 id="undi-dup">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="resort()">Save changes</button>

                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>

</div>

<div class="container-fluid">
    <ul class="nav nav-pills nav-fill text-white" id="pills-tab" role="tablist">
        <li class="nav-item badge-pill">
            <h6  class="mx-1 mt-3"><a class="button btn-success badge-pill float-right"
                                      href="export/Duplicate">Export</a></h6>
            <a class="nav-link active  bg-dark nav-pill badge-pill" id="pills-dup-tab" data-toggle="pill"
               href="#pills-dup"
               role="tab"
               aria-controls="pills-dup" aria-selected="true">
                Duplicate Records
            </a>
        </li>
        <li class="nav-item badge-pill">
            <h6  class="mx-1 mt-3"><a class="button btn-success badge-pill float-right"
                                      href="export/Undecided">Export</a></h6>
            <a class="nav-link bg-dark badge-pill" id="pills-undie-tab" data-toggle="pill" href="#pills-undie" role="tab"
               aria-controls="pills-undie" aria-selected="false">
                Undecided Records
            </a>
        </li>
        <li class="nav-item badge-pill">
            <h6 class="mx-1 mt-3"><a class="button btn-success badge-pill float-right" href="export/NewRecord">Export</a></h6>
            <a class="nav-link bg-dark badge-pill" id="pills-new-tab" data-toggle="pill" href="#pills-new" role="tab"
               aria-controls="pills-new" aria-selected="false">
                New Records
            </a>
        </li>
        <li class="nav-item badge-pill">
            <h6 class="mx-1 mt-3"><a class="button btn-success badge-pill float-right"
                                     href="export/ManualCheck">Export</a></h6>
            <a class="nav-link bg-dark badge-pill" id="pills-man-tab" data-toggle="pill" href="#pills-man"
               role="tab"
               aria-controls="pills-man" aria-selected="false">
                Manual Check
            </a>
        </li>
    </ul>
    <div class="row"> </div>
    <div class="card bg-transparent tab-content rounded" id="pills-tabContent" style="overflow-y: auto; height: 85vh">
        <div class="tab-pane show active" id="pills-dup" role="tabpanel" aria-labelledby="pills-dup-tab">
            {% render_table duplicate_table 'django_tables2/bootstrap-responsive.html' %}
        </div>
        <div class="tab-pane " id="pills-undie" role="tabpanel" aria-labelledby="pills-undie-tab">
            {% render_table undecided_table 'django_tables2/bootstrap-responsive.html' %}
        </div>
        <div class="tab-pane " id="pills-new" role="tabpanel" aria-labelledby="pills-new-tab">
            {% render_table new_record_table 'django_tables2/bootstrap-responsive.html' %}
        </div>
        <div class="tab-pane " id="pills-man" role="tabpanel" aria-labelledby="pills-man-tab">
            {% render_table manual_check_table 'django_tables2/bootstrap-responsive.html' %}
        </div>
    </div>
</div>
</body>
</html>
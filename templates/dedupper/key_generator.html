{% load static %}
{% load bootstrap3 %}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Key Generator</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script>
	 $.ajaxSetup({data: {
		csrfmiddlewaretoken: '{{ csrf_token }}'
	}});
	$(document).ready(function(){

		$(".key").click(function(){
			var sList = "";
			$('input[type=checkbox]').each(function () {
				var sThisVal = (this.checked ? "1" : "0");
				if (sThisVal === "1") {
					 sList += ( this.id + "-");
					 $(this).prop("checked", false);
				}
			});
			sList = sList.slice(0, -1);
			var key = '<li class="ui-state-default"><span class="ui-icon ui-icon-trash"></span>'+sList+'</li>';
			$("#sortable").append(key);
		});
		{#$( "#sortable" ).sortable({axis: "y"});#}
		{#$( "#sortable" ).disableSelection();#}

		$(document).on("click", "span", function (i, e) {
			if ($(this).hasClass("ui-icon-trash")) {
				$(this).parent().remove();
			}

		});

		$(document).on("click", "#keygen", function (i, e) {
			let keys = [];
			$("li").each(function () {
				keys.push($(this).text());
			});

			$.post("{% url 'rep_list_keys' %}" , {"keys": keys}, function () {
				alert("success!");
			}).fail(function() {
				alert( "error");
			});
		});
	});


	</script>

	<style>
		#new_key, #keyList{
			border: black 2px solid;
			border-radius: 20px;
			width: 250px;
			margin: 50px;
			float: left;
			display:inline-block;
			padding: 10px;

		}
		#sortable {
			 list-style-type: none;
			 margin: 0;
			 padding: 0;
		}
		#sortable li {
			margin: 0 3px 3px 3px;
			padding: 0.4em;
			padding-left: 1.5em;
			font-size: 1em;
			height: 18px;
		}
		#sortable li span {
			position: absolute;
			margin-left: -1.3em;
		}
		.switch {
		  position: relative;
		  display: inline-block;
		  width: 60px;
		  height: 34px;
		}

		.switch input {display:none;}

		.slider {
		  position: absolute;
		  cursor: pointer;
		  top: 0;
		  left: 0;
		  right: 0;
		  bottom: 0;
		  background-color: #ccc;
		  -webkit-transition: .4s;
		  transition: .4s;
		}

		.sectionFooter {
			float: bottom;
            position: absolute;
            align-self: auto;
		}

		.slider:before {
		  position: absolute;
		  content: "";
		  height: 26px;
		  width: 26px;
		  left: 4px;
		  bottom: 4px;
		  background-color: white;
		  -webkit-transition: .4s;
		  transition: .4s;
		}

		input:checked + .slider {
		  background-color: #2196F3;
		}

		input:focus + .slider {
		  box-shadow: 0 0 1px #2196F3;
		}

		input:checked + .slider:before {
		  -webkit-transform: translateX(26px);
		  -ms-transform: translateX(26px);
		  transform: translateX(26px);
		}

		/* Rounded sliders */
		.slider.round {
		  border-radius: 34px;
		}

		.slider.round:before {
		  border-radius: 50%;
		}

		tr{
			box-shadow: #8d8d8d 1px 1px 10px 1px;
			border-radius: inherit
		}
		table{
			padding: 20px;
		}
	</style>

</head>

<body>
	<div id="pageContainer">
		<header id="pageHeader"></header>
		<div id="contentContainer" class="clearfix">
			<nav id="pageNav">Nav </nav>

			<section id="pageSection">
				<header class="sectionHeader"></header>
				<article class="sectionArticle">
				<div id="new_key">
					<table>
					{% for header in headers %}
						<tr>
							<td>
                                <p align="right">
                                    {{ header }}
                                </p>
                            </td>
                            <td>
                                <div align="left" style="width: 100px; ">
                                    <label class="switch" style="float: right; alignment: top">
                                        <input type="checkbox" id="{{ header }}" class="check">
                                        <span class="slider round"></span>
                                    </label><!--<i class="fa fa-plus">-->
                                </div>
                            </td>
                        </tr>
					{% endfor %}
				</table>
				<div align="right" style="padding: 10px">
                    {% bootstrap_button "Make Key" button_class="key" size='lg' %}

				</div>
				</div>
				<div id="keyList">
					<ul id="sortable">
                    </ul>
                    <div align="right" style="padding: 10px">
                        <button id="keygen">
                            Generate Key
                        </button>
                    </div >
				</div>
                <footer class="sectionFooter">
                    <button>Next</button>
				</footer>
				</article>
			</section>

			<aside id="pageAside">aside</aside>
		</div>
		<footer id="pageFooter"></footer>
	</div>
</body>
</html>
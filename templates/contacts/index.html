<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Duplify | Upload</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/css/dataTables.dataTables.min
.css" />

</head>
<body class="bg-" style="transition: 2s; overflow: hidden">
<nav class="navbar navbar-light navbar-expand-lg justify-content-between" style="background: transparent">
    <a class="navbar-brand" href="#"> <h4>Contact Analysis</h4></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item ">
                <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/admin">Admin</a>
            </li>
            <li class="nav-item active">
                <a class="nav-link v" href="javascript:verify()">COMPUTE</a>
            </li>
        </ul>
    </div>
    <div>
        <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#modelId" onclick="plotly()">
            Plot
        </button>
    </div>
</nav>
<div class="container-fluid" style="padding-top: 1px;  height: 100%; width: 95%;">
    <div class="row text-center shadow" style="max-height: 91vh">
        <div class="col-3 bg-danger" style="overflow: scroll">
            <ul class="nav nav-tabs api col-6">
            </ul>
        </div>
        <div class="col-3 bg-success" style="overflow: scroll">
            <ul class="nav nav-tabs card-header-tabs record col-6" >
            </ul>
        </div>
        <div class="col-6 bg-primary">
            <div class="row text-title text-center"></div>
            <div class="row">
                <div class="table" style="overflow: scroll; max-height: inherit;"></div>
            </div>
        </div>
    </div>
</div>
</div>

<!-- Modal -->
<div class="modal fade" id="modelId" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modelTitleId"></h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row ">
                        <div class="col-12 plot" id="plot">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>
</div>

<script>
    $('#exampleModal').on('show.bs.modal', event => {
        var button = $(event.relatedTarget);
        var modal = $(this);
        // Use above variables to manipulate the DOM

    });
</script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"
        integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://www.jqueryscript.net/demo/Polygonal-Particles-Background-polygonizr/polygonizr.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/js/dataTables.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.material.min.js"></script>

<script>
    var plot = $("#plot");
    function plotly(){
        $.getJSON("{% url 'plotly' %}", {api_key: api_key, type_key: type_key}, function (result) {// plot the data
            var trace1 = {
                x: [1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012],
                y: [219, 146, 112, 127, 124, 180, 236, 207, 236, 263, 350, 430, 474, 526, 488, 537, 500, 439],
                name: 'Rest of world',
                marker: {color: 'rgb(55, 83, 109)'},
                type: 'bar'
            };

            var trace2 = {
                x: [1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012],
                y: [16, 13, 10, 11, 28, 37, 43, 55, 56, 88, 105, 156, 270, 299, 340, 403, 549, 499],
                name: 'China',
                marker: {color: 'rgb(26, 118, 255)'},
                type: 'bar'
            };

            var data = [trace1, trace2];

            var layout = {
                title: 'US Export of Plastic Scrap',
                xaxis: {tickfont: {
                        size: 14,
                        color: 'rgb(107, 107, 107)'
                    }},
                yaxis: {
                    title: 'USD (millions)',
                    titlefont: {
                        size: 16,
                        color: 'rgb(107, 107, 107)'
                    },
                    tickfont: {
                        size: 14,
                        color: 'rgb(107, 107, 107)'
                    }
                },
                legend: {
                    x: 0,
                    y: 1.0,
                    bgcolor: 'rgba(255, 255, 255, 0)',
                    bordercolor: 'rgba(255, 255, 255, 0)'
                },
                barmode: 'group',
                bargap: 0.15,
                bargroupgap: 0.1
            };

            Plotly.newPlot('plot', data, layout);
        });
    }
    verify();


    //TODO use mdbootstrap and datatables
    //TODO fade out then fade in chain of Start by uploading your rep list here and your salesforce report here-fade out
    function filename(file, label) {
        var name = $(file).val().replace("C:\\fakepath\\","");

        $(label).text(name);
    }

    function bg() {

        $("body").polygonizr({

            restNodeMovements: 0,// How long to pause in between new node-movements.

            duration: 4, // When the cluster updates, this sets speed of nodes.

            nodeMovementDistance: 400, // Define the maximum distance to move nodes.

            numberOfNodes: 36,// The number of node nodes to print out.

            nodeDotSize: 2.5,// Define the maximum size of each node dot.

            nodeEase: "linear",//linear, easeIn, easeOut, easeInOut, accelerateDecelerate.

            nodeFancyEntrance: false,// If true, the nodes will descend into place on load.

            randomizePolygonMeshNetworkFormation: false,// Makes the cluster forms an ellipse inspired formation, random if true.

            // Define a formula for how to initialize each node dot's position.
            specifyPolygonMeshNetworkFormation: function (i) {
                var forEachNode = {// Half a circle and randomized
                    x: this.canvasWidth - ((this.canvasWidth / 2) + (this.canvasHeight / 2) * Math.cos(i * (2 * Math.PI / this.numberOfNodes))) * Math.random(),
                    y: this.canvasHeight - (this.canvasHeight * (i / this.numberOfNodes))
                };
                return forEachNode;
            },

            nodeRelations: 15,// Number of relations between nodes.

            animationFps: 300, // The FPS for the whole canvas.

            nodeDotColor: "0, 0 0 ",// Sets the color of the nodes in the network (RGB).

            nodeLineColor: "0, 0, 0 ",// Sets the color of the lines in the network (RGB).

            nodeFillColor: "0, 0, 0 ",// Sets the color of  triangles in the network (RGB).

            nodeFillAlpha: 2,// Sets the alpha level for the colors (1-0).

            nodeLineAlpha: 0, // Sets the alpha level for the lines (1-0).

            nodeDotAlpha: 0,// Sets the alpha level for the dots (1-0).

            nodeFillSpace: true,// Defines if the triangles in the network should be shown.

            nodeGlowing: false,// Define if the active animation should glow or not (not CPU friendly).

            // Define the canvas size and css position.
            canvasWidth: $(this).width(),
            canvasHeight: $(this).height(),
            canvasPosition: "absolute"

        });
        $("body").polygonizr({

            restNodeMovements: 0,// How long to pause in between new node-movements.

            duration: 8, // When the cluster updates, this sets speed of nodes.

            nodeMovementDistance: 400, // Define the maximum distance to move nodes.

            numberOfNodes: 36,// The number of node nodes to print out.

            nodeDotSize: 1,// Define the maximum size of each node dot.

            nodeEase: "linear",//linear, easeIn, easeOut, easeInOut, accelerateDecelerate.

            nodeFancyEntrance: false,// If true, the nodes will descend into place on load.

            randomizePolygonMeshNetworkFormation: false,// Makes the cluster forms an ellipse inspired formation, random if true.

            // Define a formula for how to initialize each node dot's position.
            specifyPolygonMeshNetworkFormation: function (i) {
                var forEachNode = {// Half a circle and randomized
                    x: this.canvasWidth - ((this.canvasWidth / 2) + (this.canvasHeight / 2) * Math.cos(i * (2 * Math.PI / this.numberOfNodes))) * Math.random(),
                    y: this.canvasHeight - (this.canvasHeight * (i / this.numberOfNodes))
                };
                return forEachNode;
            },

            nodeRelations: 15,// Number of relations between nodes.

            animationFps: 300, // The FPS for the whole canvas.

            nodeDotColor: "255, 255, 255 ",// Sets the color of the nodes in the network (RGB).

            nodeLineColor: "255, 255, 255",// Sets the color of the lines in the network (RGB).

            nodeFillColor: "255, 255, 255 ",// Sets the color of  triangles in the network (RGB).

            nodeFillAlpha: 3,// Sets the alpha level for the colors (1-0).

            nodeLineAlpha: 0, // Sets the alpha level for the lines (1-0).

            nodeDotAlpha: 0,// Sets the alpha level for the dots (1-0).

            nodeFillSpace: true,// Defines if the triangles in the network should be shown.

            nodeGlowing: false,// Define if the active animation should glow or not (not CPU friendly).

            // Define the canvas size and css position.
            canvasWidth: $(this).width(),
            canvasHeight: $(this).height(),
            canvasPosition: "absolute"

        });
    }
    bg();


    var api_key, type_key='';



    function verify(){
        $.getJSON("{% url 'contacts' %}", {threshold: 1, num_records: 12}, function(result){
            api_name( result['api_names']);
            record_types(result['record_types']);

        });
    }

    function api_name(api) {
        $(api).each(function () {
            $(".api").append('' +
                '<li class="nav-item"> <button class="btn btn-primary m-1 nav-pill api-key" ' +
                'onclick="set_api_key' +
                '(\''+this+
                '\')">'+this+'</button> </li>');
        });
    }
    function record_types(type) {
        $(type).each(function () {
            $(".record").append('' +
                '<li class="nav-item"> <a class="btn btn-primary nav-pill m-1 record-key" ' +
                'href="javascript:set_key_type(\''+this+
                '\')">'+this+'</a> </li>');
        });
    }
    function f() {
        if (confirm('WARNING: You are about to erase all records in the database.')) {
            window.location.replace("{% url 'flush_db' %}");
        } else {
            // Do nothing!
        }
    }


    function get_table() {
        $.getJSON("{% url 'table' %}", {api_key: api_key, type_key: type_key}, function(result) {
            $('.text-title').html(api_key +' - ' + type_key);
            $('.table').html(result['table']);
            $('.dataframe').DataTable();
            $('table').toggleClass('compact hover');

        });
    }
    function set_api_key(api) {
        api_key = api;
        get_table();

    }
    function set_key_type(types) {
        type_key=types;
        get_table();

    }
</script>
</body>
</html>